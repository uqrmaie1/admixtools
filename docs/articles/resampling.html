<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Standard errors • admixtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><script src="../extra.js"></script><meta property="og:title" content="Standard errors">
<meta property="og:description" content="admixtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-155330476-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-155330476-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admixtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admixtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fstats.html">f-statistics</a>
    </li>
    <li>
      <a href="../articles/graphs.html">Admixture graphs</a>
    </li>
    <li>
      <a href="../articles/io.html">Genotype data</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallelization</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting</a>
    </li>
    <li>
      <a href="../articles/qpadm.html">qpWave and qpAdm</a>
    </li>
    <li>
      <a href="../articles/resampling.html">Standard errors</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/uqrmaie1/admixtools/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="resampling_files/header-attrs-2.5/header-attrs.js"></script><link href="resampling_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="resampling_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Standard errors</h1>
                        <h4 class="author">Robert Maier</h4>
            
            <h4 class="date">2021-01-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/uqrmaie1/admixtools/blob/master/vignettes/resampling.Rmd"><code>vignettes/resampling.Rmd</code></a></small>
      <div class="hidden name"><code>resampling.Rmd</code></div>

    </div>

    
    
<p><strong>Under construction</strong></p>
<div id="quantifying-uncertainty" class="section level2">
<h2 class="hasAnchor">
<a href="#quantifying-uncertainty" class="anchor"></a>Quantifying uncertainty</h2>
<p>The estimates produced by <em>ADMIXTOOLS 2</em> (and by any other software) have high, but still limited precision, and it’s often important to know what those limits are. There are several reasons why there is uncertainty in an estimate, but the two major ones in our case are the random sampling of individuals, and the random sampling (or rather the random drift) of SNPs: How different would the results be if we had used DNA from different individuals (from the same populations)? And how different would the results be if we could replay the same history, while letting the SNPs drift randomly another time?</p>
<p>We can answer these questions with resampling procedures such as jackknife and bootstrap. The original <em>ADMIXTOOLS</em> software uses jackknife to estimate standard errors of <em>f</em>-statistic estimates and other parameters, while <em>ADMIXTOOLS 2</em> can also compute bootstrap standard errors. See <strong>add section</strong> for a comparison of the two methods. Unless otherwhise mentioned, standard errors estimate the uncertainty due to the random sampling of SNPs, although <em>ADMIXTOOLS 2</em> also has functions that estimate the uncertainty due to the random sampling of individuals.</p>
</div>
<div id="standard-errors-and-hypothesis-testing" class="section level2">
<h2 class="hasAnchor">
<a href="#standard-errors-and-hypothesis-testing" class="anchor"></a>Standard errors and hypothesis testing</h2>
<p>Let’s say we want to know whether populations <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> form a clade relative to <span class="math inline">\(C\)</span> and <span class="math inline">\(D\)</span>. We can reject the null hypothesis that they do form a clade if <span class="math inline">\(f_4(A, B; C, D)\)</span> significantly deviates from zero – if there is a significant covariance between the allele frequency differences <span class="math inline">\(A-B\)</span> and <span class="math inline">\(C-D\)</span>.</p>
<p>To test whether this covariance is significant, we have to estimate its standard error, which will allow us to calculate a <em>p</em>-value – the probability to observe this or a more extreme <span class="math inline">\(f_4\)</span> statistic under the null hypothesis (the two population pairs form a clade and the true covariance is zero).</p>
</div>
<div id="jackknife-and-bootstrap" class="section level2">
<h2 class="hasAnchor">
<a href="#jackknife-and-bootstrap" class="anchor"></a>Jackknife and bootstrap</h2>
<p>The idea behind jackknife and bootstrap is that while it’s impossible to know with certainty how different a result would be if we had different data, we can make an educated guess by analyzing many different subsets of the data. In the case of jackknife, the subsets are generated by leaving out each sample at a time, and for bootstrap they are generated by repeatedly resampling with replacement until the total number of samples is reached. In our case “samples” are usually blocks of SNPs.</p>
<p>We then calculate whichever statistic we’re interested in on each of the subsets, resulting in <span class="math inline">\(n\)</span> subset-statistics <span class="math inline">\(\hat\theta_{-i}\)</span>. From the variation in <span class="math inline">\(\hat\theta_{-i}\)</span> we can estimate the standard error <span class="math inline">\(\sigma\)</span>.</p>
<p>For jackknife, the squared standard error estimate, <span class="math inline">\(\hat\sigma^2\)</span>, is given by</p>
<p><span class="math display">\[\hat\sigma^2 = \frac{n-1}{n} \sum_{i=1}^n (\hat\theta_J - \hat\theta_{-i})^2\]</span></p>
<p><span class="math inline">\(\hat\theta_J\)</span> is the estimate on the whole data set, and <span class="math inline">\(\hat\theta_J\)</span> is the jackknife estimate, which is usually very close to the estimate on the whole data set: <span class="math inline">\(\hat\theta_J = n \hat\theta - \frac{n-1}{n} \sum_{i=1}^n \hat\theta_{-i}\)</span></p>
<p><br></p>
<p>For bootstrap, where the <span class="math inline">\(\hat\theta_{-i}\)</span> are more different from each other as multiple values are excluded in each subset <span class="math inline">\(i\)</span>, the squared standard error estimate is just the variance across <span class="math inline">\(\hat\theta_{-i}\)</span>:</p>
<p><span class="math display">\[\hat\sigma^2 = \frac{1}{n-1} \sum_{i=1}^n (\hat\theta - \hat\theta_{-i})^2\]</span></p>
<p><br></p>
</div>
<div id="blockedd-jackknife-and-bootstrap" class="section level2">
<h2 class="hasAnchor">
<a href="#blockedd-jackknife-and-bootstrap" class="anchor"></a>Blockedd jackknife and bootstrap</h2>
<p>We can’t actually use the approach described so far because SNPs do not drift independently of each other. While there are tens of millions of common SNPs in the human genome, the number of independent SNPs is closer to 50,000. If we don’t account for that, the standard errors will be greatly underestimated, leading to many false positive results.</p>
<p>The non-independence of SNPs (linkage disequilibrium) is mostly limited to SNPs in close proximity which are not separated by recombination hotspots. If we take two SNPs separated by 5 centiMorgan or more, they are usually independent of each other. So while we can’t use the standard jackknife to get standard error estimates by leaving out each SNP at a time, we can divide the genome into blocks of 5 centiMorgan and leave out each block at a time. This complicates things a bit because some blocks have more SNPs than others, and should be weighted appropriately.</p>
<p>The exact equations used in <em>ADMIXTOOLS</em> and <em>ADMIXTOOLS 2</em> for computing standard errors with the weighted block jackknife are given <a href="https://reich.hms.harvard.edu/sites/reich.hms.harvard.edu/files/inline-files/wjack.pdf">here</a>. Lecture slides by Nick Patterson on the jackknife method are available <a href="https://reich.hms.harvard.edu/sites/reich.hms.harvard.edu/files/inline-files/lecture2.pdf">here</a>.</p>
<p><br></p>
<p>For statistics for which estimates from multiple SNPs are the means across estimates from single SNPs (such as <em>f</em>-statistics), the equations get a lot simpler.</p>
<p>In that case, the jackknife estimate will be the same as the estimate on the whole data set: <span class="math inline">\(\hat\theta_J = \hat\theta\)</span>. And the squared standard error estimate simplifies to</p>
<p><span class="math display">\[\hat\sigma^2 = \frac{1}{g} \sum_{i=1}^g (\frac{n-m_i}{m_i}) (\hat\theta - \hat\theta_{-i})^2\]</span> Here, <span class="math inline">\(g\)</span> is the number of blocks, <span class="math inline">\(n\)</span> is the total number of SNPs, and <span class="math inline">\(m_i\)</span> is the number of SNPs in each block. If each SNP is its own block, <span class="math inline">\(m_i = 1\)</span>, <span class="math inline">\(g = n\)</span>, and the equation above will be equal to the non-blocked version.</p>
<p>The same quantity can also be expressed using only per-block statistics <span class="math inline">\(\hat\theta_{i}\)</span>, rather than leave-one-block-out statistics <span class="math inline">\(\hat\theta_{-i}\)</span>, which simplifies the computation:</p>
<p><span class="math display">\[\hat\sigma^2 = \frac{1}{g} \sum_{i=1}^g (\frac{m_i}{n-m_i}) (\hat\theta - \hat\theta_{i})^2\]</span></p>
<!-- $$\sigma^2 = \frac{1}{n} \sum_{i=1}^n \frac{1}{x_i - 1} (x_i \mu_{tot} - \mu_{jack} - s_i (x_i-1) )^2$$ -->
<!-- where $\mu_{tot}$ is the mean calculated from all blocks, $\mu_{jack} = \frac{1}{n} \sum_i s_i$ (the jackknife mean), and $x_i = \frac{\sum{l_i}}{l_i}$ (the inverse of the relative block length). -->
<div id="resampling-snps-need-to-update-this" class="section level3">
<h3 class="hasAnchor">
<a href="#resampling-snps-need-to-update-this" class="anchor"></a>Resampling SNPS – need to update this</h3>
<p>The subsampling of SNPs in blocks (sepcifically block jackknife) is already used throughout all <em>ADMIXTOOLS</em> programs to compute standard erorrs. Here, the <code>resample_snps</code> functions generalize this approach in two ways. First, they evaluate and returns <em>all</em> model parameters for each set of resampled SNP blocks. Second, they provide the option to do bootstrap resampling (resampling blocks with replacement while keeping the total number of blocks fixed) rather than jackknife resampling (leaving one block out at a time). The advantage of bootstrap over jackknife resampling is that bootstrap resampling is less likely to underestimate the true variability in the presence of a few, large outliers. The disadvantage is that it is inherently stochastic and doesn’t give the same results each time. Bootstrapping also makes it necessary to evaluate the whole model a large number of times, while jackknifing can be much faster, at least when computing only simple statistics.</p>
<p>Note that the bootstrap and jackknife resampling distributions are on different scales: Bootstrap standard errors are the square root of the sampling variance, whereas jackknife standard errors are the square root of <em>n times</em> the sampling variance.</p>
<p>In following example, 1000 models with resampled SNP blocks are evaluated, and a histogram of the likelihood scores is plotted.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">snpres</span> <span class="op">=</span> <span class="fu"><a href="../reference/resample_snps.html">qpgraph_resample_snps</a></span><span class="op">(</span><span class="va">example_f2_blocks</span>, graph <span class="op">=</span> <span class="va">example_graph</span>, boot <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">snpres</span><span class="op">$</span><span class="va">score</span>, <span class="fl">100</span><span class="op">)</span></code></pre></div>
</div>
<div id="resampling-individuals" class="section level3">
<h3 class="hasAnchor">
<a href="#resampling-individuals" class="anchor"></a>Resampling individuals</h3>
<p>We can also test how robust a model is to changes in the individuals that make up a population. The <code>resample_inds</code> functions evaluate every model that results from excluding one individual, for each individual in populations with at least two individuals.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pops</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_leafnames.html">get_leafnames</a></span><span class="op">(</span><span class="va">example_igraph</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span><span class="op">)</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span><span class="op">]</span>
<span class="va">indres</span> <span class="op">=</span> <span class="fu"><a href="../reference/resample_inds.html">qpgraph_resample_inds</a></span><span class="op">(</span><span class="va">my_counts_dir</span>, inds <span class="op">=</span> <span class="va">inds</span>, pops <span class="op">=</span> <span class="va">pops</span>, graph <span class="op">=</span> <span class="va">example_graph</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">indres</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">score</span>, <span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">ind</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For populations with many individuals, this can be used to compute jackknife standard errors for statistics of that population.</p>
<p><br></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robert Maier, Nick Patterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c30b6be96312414d83a0ba52b94b558b',
    indexName: 'admixtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
