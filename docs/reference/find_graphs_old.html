<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find well fitting admixture graphs — find_graphs_old • admixtools</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


  
  <script src="../extra.js"></script>

<meta property="og:title" content="Find well fitting admixture graphs — find_graphs_old" />
<meta property="og:description" content="This function generates and evaluates admixture graphs in numgen iterations across numrep independent repeats
to find well fitting admixturegraphs. It uses the function future_map
to parallelize across the independent repeats. The function plan can be called
to specify the details of the parallelization. This can be used to parallelize across cores or across nodes on
a compute cluster. Setting numadmix to 0 will search for well fitting trees, which is much faster than searching
for admixture graphs with many admixture nodes." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9DRRL9PZD0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9DRRL9PZD0');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admixtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admixtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fstats.html">f-statistics</a>
    </li>
    <li>
      <a href="../articles/graphs.html">Admixture graphs</a>
    </li>
    <li>
      <a href="../articles/io.html">Data formats</a>
    </li>
    <li>
      <a href="../articles/paper.html">Paper notes</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallelization</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting</a>
    </li>
    <li>
      <a href="../articles/qpadm.html">qpWave and qpAdm</a>
    </li>
    <li>
      <a href="../articles/resampling.html">Standard errors</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/uqrmaie1/admixtools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find well fitting admixture graphs</h1>
    <small class="dont-index">Source: <a href='https://github.com/uqrmaie1/admixtools/blob/master/R/toposearch.R'><code>R/toposearch.R</code></a></small>
    <div class="hidden name"><code>find_graphs_old.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function generates and evaluates admixture graphs in <code>numgen</code> iterations across <code>numrep</code> independent repeats
to find well fitting admixturegraphs. It uses the function <code><a href='https://rdrr.io/pkg/furrr/man/future_map.html'>future_map</a></code>
to parallelize across the independent repeats. The function <code><a href='https://rdrr.io/pkg/future/man/plan.html'>plan</a></code> can be called
to specify the details of the parallelization. This can be used to parallelize across cores or across nodes on
a compute cluster. Setting <code>numadmix</code> to 0 will search for well fitting trees, which is much faster than searching
for admixture graphs with many admixture nodes.</p>
    </div>

    <pre class="usage"><span class='fu'>find_graphs_old</span><span class='op'>(</span>
  <span class='va'>data</span>,
  pops <span class='op'>=</span> <span class='cn'>NULL</span>,
  outpop <span class='op'>=</span> <span class='cn'>NULL</span>,
  numrep <span class='op'>=</span> <span class='fl'>1</span>,
  numgraphs <span class='op'>=</span> <span class='fl'>50</span>,
  numgen <span class='op'>=</span> <span class='fl'>5</span>,
  numsel <span class='op'>=</span> <span class='fl'>5</span>,
  numadmix <span class='op'>=</span> <span class='fl'>0</span>,
  numstart <span class='op'>=</span> <span class='fl'>1</span>,
  keep <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"all"</span>, <span class='st'>"best"</span>, <span class='st'>"last"</span><span class='op'>)</span>,
  initgraphs <span class='op'>=</span> <span class='cn'>NULL</span>,
  mutfuns <span class='op'>=</span> <span class='fu'>namedList</span><span class='op'>(</span><span class='va'>spr_leaves</span>, <span class='va'>spr_all</span>, <span class='va'>swap_leaves</span>, <span class='va'>move_admixedge_once</span>,
    <span class='va'>flipadmix_random</span>, <span class='va'>mutate_n</span><span class='op'>)</span>,
  mutprobs <span class='op'>=</span> <span class='cn'>NULL</span>,
  opt_worst_residual <span class='op'>=</span> <span class='cn'>FALSE</span>,
  store_intermediate <span class='op'>=</span> <span class='cn'>NULL</span>,
  parallel <span class='op'>=</span> <span class='cn'>TRUE</span>,
  stop_after <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>Input data in one of three forms:</p><ol>
<li><p>A 3d array of blocked f2 statistics, output of <code><a href='f2_from_precomp.html'>f2_from_precomp</a></code> or <code><a href='f2_from_geno.html'>f2_from_geno</a></code></p></li>
<li><p>A directory which contains pre-computed f2-statistics</p></li>
<li><p>The prefix of genotype files</p></li>
</ol></td>
    </tr>
    <tr>
      <th>pops</th>
      <td><p>Populations for which to fit admixture graphs (default all)</p></td>
    </tr>
    <tr>
      <th>outpop</th>
      <td><p>An outgroup population which will split at the root from all other populations in all tested graphs. If one of the populations is know to be an outgroup, designating it as <code>outpop</code> will greatly reduce the search space compared to including it and not designating it as <code>outpop</code>.</p></td>
    </tr>
    <tr>
      <th>numrep</th>
      <td><p>Number of independent repetitions (each repetition can be run in parallel)</p></td>
    </tr>
    <tr>
      <th>numgraphs</th>
      <td><p>Number of graphs in each generation</p></td>
    </tr>
    <tr>
      <th>numgen</th>
      <td><p>Number of generations</p></td>
    </tr>
    <tr>
      <th>numsel</th>
      <td><p>Number of graphs which are selected in each generation. Should be less than <code>numgraphs</code>.</p></td>
    </tr>
    <tr>
      <th>numadmix</th>
      <td><p>Number of admixture events within each graph</p></td>
    </tr>
    <tr>
      <th>numstart</th>
      <td><p>Number of random initializations in each call to <code>qpgraph</code>. Defaults to 1, to speed up the graph optimization.</p></td>
    </tr>
    <tr>
      <th>keep</th>
      <td><p>Which models should be returned. One of <code>all</code>, <code>best</code>, <code>last</code></p><ul>
<li><p><code>all</code> (default): Return all evaluated graphs</p></li>
<li><p><code>best</code>: Return only the best fitting graph from each repeat and each generation</p></li>
<li><p><code>last</code>: Return all graphs from the last generation</p></li>
</ul></td>
    </tr>
    <tr>
      <th>initgraphs</th>
      <td><p>Optional graph or list of igraphs to start with. If <code>NULL</code>, optimization will start with random graphs.</p></td>
    </tr>
    <tr>
      <th>mutfuns</th>
      <td><p>Functions used to modify graphs. Defaults to the following:</p><ul>
<li><p><code><a href='spr_leaves.html'>spr_leaves</a></code>: Subtree prune and regraft leaves. Cuts a leaf node and attaches it
to a random other edge in the graph.</p></li>
<li><p><code><a href='spr_all.html'>spr_all</a></code>: Subtree prune and regraft. Cuts any edge and attaches the new orphan node
to a random other edge in the graph, keeping the number of admixture nodes constant.</p></li>
<li><p><code><a href='swap_leaves.html'>swap_leaves</a></code>: Swaps two leaf nodes.</p></li>
<li><p><code><a href='move_admixedge_once.html'>move_admixedge_once</a></code>: Moves an admixture edge to a nearby location.</p></li>
<li><p><code><a href='flipadmix_random.html'>flipadmix_random</a></code>: Flips the direction of an admixture edge (if possible).</p></li>
<li><p><code><a href='mutate_n.html'>mutate_n</a></code>: Apply <code>n</code> of the mutation functions in this list to a graph (defaults to 2).</p></li>
</ul><p>See examples for how to make new mutation functions.</p></td>
    </tr>
    <tr>
      <th>mutprobs</th>
      <td><p>Relative frequencies of each mutation function.</p><ul>
<li><p><code>NULL</code> (default) means each mutation function is picked with equal probability</p></li>
<li><p>A numeric vector of length equal to <code>mutfuns</code> defines the relative frequency of each mutation function</p></li>
<li><p>A matrix of dimensions <code>numgen</code> x <code><a href='https://rdrr.io/r/base/length.html'>length(mutfuns)</a></code> defines the relative frequency of each mutation function in each generation</p></li>
</ul></td>
    </tr>
    <tr>
      <th>opt_worst_residual</th>
      <td><p>Optimize for lowest worst residual instead of best score. <code>FALSE</code> by default, because the likelihood score is generally a better indicator of the quality of the model fit. Optimizing for the lowest worst residual is also slower (because f4-statistics need to be computed).</p></td>
    </tr>
    <tr>
      <th>store_intermediate</th>
      <td><p>Path and prefix of files for intermediate results to <code>.rds</code>. Can be useful if <code>find_graphs_old</code> doesn't finish sucessfully.</p></td>
    </tr>
    <tr>
      <th>parallel</th>
      <td><p>Parallelize over repeats (if <code>numrep &gt; 1</code>) or graphs (if <code>numrep == 1</code>) by replacing <code><a href='https://purrr.tidyverse.org/reference/map.html'>map</a></code> with <code><a href='https://rdrr.io/pkg/furrr/man/future_map.html'>future_map</a></code>. Will only be effective if <code><a href='https://rdrr.io/pkg/future/man/plan.html'>plan</a></code> has been set.</p></td>
    </tr>
    <tr>
      <th>stop_after</th>
      <td><p>Stop optimization after <code>stop_after</code> seconds (and after finishing the current generation).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Print progress updates</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='qpgraph.html'>qpgraph</a></code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A nested data frame with one model per line</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='qpgraph.html'>qpgraph</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'>find_graphs_old</span><span class='op'>(</span><span class='va'>example_f2_blocks</span>, numrep <span class='op'>=</span> <span class='fl'>200</span>, numgraphs <span class='op'>=</span> <span class='fl'>100</span>,
            numgen <span class='op'>=</span> <span class='fl'>20</span>, numsel <span class='op'>=</span> <span class='fl'>5</span>, numadmix <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Making new mutation functions by modifying or combining existing ones:</span>
<span class='va'>newfun1</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>graph</span>, <span class='va'>...</span><span class='op'>)</span> <span class='fu'><a href='mutate_n.html'>mutate_n</a></span><span class='op'>(</span><span class='va'>graph</span>, <span class='fl'>3</span>, <span class='va'>...</span><span class='op'>)</span>
<span class='va'>newfun2</span> <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>graph</span>, <span class='va'>...</span><span class='op'>)</span> <span class='fu'><a href='flipadmix_random.html'>flipadmix_random</a></span><span class='op'>(</span><span class='fu'><a href='spr_leaves.html'>spr_leaves</a></span><span class='op'>(</span><span class='va'>graph</span>, <span class='va'>...</span><span class='op'>)</span>, <span class='va'>...</span><span class='op'>)</span>
<span class='fu'>find_graphs_old</span><span class='op'>(</span><span class='va'>f2_blocks</span>, mutfuns <span class='op'>=</span> <span class='fu'>namedList</span><span class='op'>(</span><span class='va'>spr_leaves</span>, <span class='va'>newfun1</span>, <span class='va'>newfun2</span><span class='op'>)</span>, mutprobs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.2</span>, <span class='fl'>0.3</span>, <span class='fl'>0.5</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Robert Maier, Nick Patterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'c30b6be96312414d83a0ba52b94b558b',
    indexName: 'admixtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


