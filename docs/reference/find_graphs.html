<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Find well fitting admixture graphs — find_graphs • admixtools</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>


<!-- docsearch -->
<script src="../docsearch.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous" />
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>


  
  <script src="../extra.js"></script>

<meta property="og:title" content="Find well fitting admixture graphs — find_graphs" />
<meta property="og:description" content="This function generates and evaluates admixture graphs in numgen iterations
to find well fitting admixturegraphs." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9DRRL9PZD0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9DRRL9PZD0');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">admixtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/admixtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/fstats.html">f-statistics</a>
    </li>
    <li>
      <a href="../articles/graphs.html">Admixture graphs</a>
    </li>
    <li>
      <a href="../articles/io.html">Data formats</a>
    </li>
    <li>
      <a href="../articles/paper.html">Paper notes</a>
    </li>
    <li>
      <a href="../articles/parallel.html">Parallelization</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting</a>
    </li>
    <li>
      <a href="../articles/qpadm.html">qpWave and qpAdm</a>
    </li>
    <li>
      <a href="../articles/resampling.html">Standard errors</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/uqrmaie1/admixtools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
      <form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
        </div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find well fitting admixture graphs</h1>
    <small class="dont-index">Source: <a href='https://github.com/uqrmaie1/admixtools/blob/master/R/toposearch.R'><code>R/toposearch.R</code></a></small>
    <div class="hidden name"><code>find_graphs.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function generates and evaluates admixture graphs in <code>numgen</code> iterations
to find well fitting admixturegraphs.</p>
    </div>

    <pre class="usage"><span class='fu'>find_graphs</span><span class='op'>(</span>
  <span class='va'>data</span>,
  numadmix <span class='op'>=</span> <span class='fl'>0</span>,
  outpop <span class='op'>=</span> <span class='cn'>NULL</span>,
  stop_gen <span class='op'>=</span> <span class='fl'>100</span>,
  stop_gen2 <span class='op'>=</span> <span class='fl'>15</span>,
  stop_score <span class='op'>=</span> <span class='fl'>0</span>,
  stop_sec <span class='op'>=</span> <span class='cn'>NULL</span>,
  initgraph <span class='op'>=</span> <span class='cn'>NULL</span>,
  numgraphs <span class='op'>=</span> <span class='fl'>10</span>,
  mutfuns <span class='op'>=</span> <span class='fu'>namedList</span><span class='op'>(</span><span class='va'>spr_leaves</span>, <span class='va'>spr_all</span>, <span class='va'>swap_leaves</span>, <span class='va'>move_admixedge_once</span>,
    <span class='va'>flipadmix_random</span>, <span class='va'>place_root_random</span>, <span class='va'>mutate_n</span><span class='op'>)</span>,
  opt_worst_residual <span class='op'>=</span> <span class='cn'>FALSE</span>,
  plusminus_generations <span class='op'>=</span> <span class='fl'>5</span>,
  return_searchtree <span class='op'>=</span> <span class='cn'>FALSE</span>,
  admix_constraints <span class='op'>=</span> <span class='cn'>NULL</span>,
  event_constraints <span class='op'>=</span> <span class='cn'>NULL</span>,
  reject_f4z <span class='op'>=</span> <span class='fl'>0</span>,
  max_admix <span class='op'>=</span> <span class='va'>numadmix</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>Input data in one of three forms:</p><ol>
<li><p>A 3d array of blocked f2 statistics, output of <code><a href='f2_from_precomp.html'>f2_from_precomp</a></code> or <code><a href='f2_from_geno.html'>f2_from_geno</a></code></p></li>
<li><p>A directory which contains pre-computed f2-statistics</p></li>
<li><p>The prefix of genotype files</p></li>
</ol></td>
    </tr>
    <tr>
      <th>numadmix</th>
      <td><p>Number of admixture events within each graph. (Only relevant if <code>initgraph = NULL</code>)</p></td>
    </tr>
    <tr>
      <th>outpop</th>
      <td><p>Name of the outgroup population</p></td>
    </tr>
    <tr>
      <th>stop_gen</th>
      <td><p>Total number of generations after which to stop</p></td>
    </tr>
    <tr>
      <th>stop_gen2</th>
      <td><p>Number of generations without improvement after which to stop</p></td>
    </tr>
    <tr>
      <th>stop_score</th>
      <td><p>Stop once this score has been reached</p></td>
    </tr>
    <tr>
      <th>stop_sec</th>
      <td><p>Number of seconds after which to stop</p></td>
    </tr>
    <tr>
      <th>initgraph</th>
      <td><p>Graph to start with. If it is specified, <code>numadmix</code> and <code>outpop</code> will be inferred from this graph.</p></td>
    </tr>
    <tr>
      <th>numgraphs</th>
      <td><p>Number of graphs in each generation</p></td>
    </tr>
    <tr>
      <th>mutfuns</th>
      <td><p>Functions used to modify graphs. Defaults to the following:</p><ul>
<li><p><code><a href='spr_leaves.html'>spr_leaves</a></code>: Subtree prune and regraft leaves. Cuts a leaf node and attaches it
to a random other edge in the graph.</p></li>
<li><p><code><a href='spr_all.html'>spr_all</a></code>: Subtree prune and regraft. Cuts any edge and attaches the new orphan node
to a random other edge in the graph, keeping the number of admixture nodes constant.</p></li>
<li><p><code><a href='swap_leaves.html'>swap_leaves</a></code>: Swaps two leaf nodes.</p></li>
<li><p><code><a href='move_admixedge_once.html'>move_admixedge_once</a></code>: Moves an admixture edge to a nearby location.</p></li>
<li><p><code><a href='flipadmix_random.html'>flipadmix_random</a></code>: Flips the direction of an admixture edge (if possible).</p></li>
<li><p><code><a href='mutate_n.html'>mutate_n</a></code>: Apply <code>n</code> of the mutation functions in this list to a graph (defaults to 2).</p></li>
</ul></td>
    </tr>
    <tr>
      <th>opt_worst_residual</th>
      <td><p>Optimize for lowest worst residual instead of best score. <code>FALSE</code> by default, because the likelihood score is generally a better indicator of the quality of the model fit, and because optimizing for the lowest worst residual is slower (because f4-statistics need to be computed).</p></td>
    </tr>
    <tr>
      <th>plusminus_generations</th>
      <td><p>If the best score does not improve after <code>plusminus_generations</code> generations, another approach to improving the score will be attempted: A number of graphs with on additional admixture edge will be generated and evaluated. The resulting graph with the best score will be picked, and new graphs will be created by removing any one admixture edge (bringing the number back to what it was originally). The graph with the lowest score will then be selected. This often makes it possible to break out of local optima, but is slower than regular graph modifications.
If the current number of admixture events is lower than <code>max_numadmix</code>, the last step (removing an admixture edge) will be skipped.</p></td>
    </tr>
    <tr>
      <th>return_searchtree</th>
      <td><p>Return the search tree in addition to the models. Output will be a list with three items: models, search tree, search tree as data frame</p></td>
    </tr>
    <tr>
      <th>admix_constraints</th>
      <td><p>A data frame with constraints on the number of admixture events for each population.
See <code><a href='satisfies_numadmix.html'>satisfies_numadmix</a></code>
As soon as one graph happens to satisfy these constraints, all subsequently generated graphs will be required to also satisfy them.</p></td>
    </tr>
    <tr>
      <th>event_constraints</th>
      <td><p>A data frame with constraints on the order of events in an admixture graph.
See <code><a href='satisfies_eventorder.html'>satisfies_eventorder</a></code>
As soon as one graph happens to satisfy these constraints, all subsequently generated graphs will be required to also satisfy them.</p></td>
    </tr>
    <tr>
      <th>reject_f4z</th>
      <td><p>If this is a number greater than zero, all f4-statistics with <code>abs(z) &gt; reject_f4z</code> will be used to constrain the search space of admixture graphs: Any graphs in which f4-statistics greater than <code>reject_f4z</code> are expected to be zero will not be evaluated.</p></td>
    </tr>
    <tr>
      <th>max_admix</th>
      <td><p>Maximum number of admixture edges. By default, this number is equal to <code>numadmix</code>, or to the number of admixture edges in <code>initgraph</code>, so the number of admixture edges stays constant. Setting this to a higher number will lead to more admixture edges being added occasionally (see <code>plusminus_generations</code>). Graphs with additional admixture edges will only be accepted if they improve the score by 5% or more.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Print progress updates</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='qpgraph.html'>qpgraph</a></code></p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A nested data frame with one model per line</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='qpgraph.html'>qpgraph</a></code>, <code><a href='find_graphs_old.html'>find_graphs_old</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='va'>res</span> <span class='op'>=</span> <span class='fu'>find_graphs</span><span class='op'>(</span><span class='va'>example_f2_blocks</span>, numadmix <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>res</span> <span class='op'>%&gt;%</span> <span class='fu'>slice_min</span><span class='op'>(</span><span class='va'>score</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># Start with a graph with 0 admixture events, increase up to 3, and stop after 10 generations of no improvement</span>
<span class='va'>pops</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/dimnames.html'>dimnames</a></span><span class='op'>(</span><span class='va'>example_f2_blocks</span><span class='op'>)</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
<span class='va'>initgraph</span> <span class='op'>=</span> <span class='fu'><a href='random_admixturegraph.html'>random_admixturegraph</a></span><span class='op'>(</span><span class='va'>pops</span>, <span class='fl'>0</span>, outpop <span class='op'>=</span> <span class='st'>'Chimp.REF'</span><span class='op'>)</span>
<span class='va'>res</span> <span class='op'>=</span> <span class='fu'>find_graphs</span><span class='op'>(</span><span class='va'>example_f2_blocks</span>, initgraph <span class='op'>=</span> <span class='va'>initgraph</span>, stop_gen2 <span class='op'>=</span> <span class='fl'>10</span>, max_admix <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
<span class='va'>res</span> <span class='op'>%&gt;%</span> <span class='fu'>slice_min</span><span class='op'>(</span><span class='va'>score</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Robert Maier, Nick Patterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script>
<script>
  docsearch({
    
    
    apiKey: 'c30b6be96312414d83a0ba52b94b558b',
    indexName: 'admixtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>



  </body>
</html>


